CREATE OR REPLACE FUNCTION basic.heatmap_prepare_artificial(
	x double precision[], y double precision[], max_cutoff double precision, 
	speed double precision, modus text, scenario_id integer, routing_profile TEXT, 
	drop_table BOOLEAN = True, grid_ids Text[] = NULL, artificial_tables_prefix TEXT = 'worker1')
 RETURNS TABLE(starting_id integer, grid_id text)
 LANGUAGE plpgsql
AS $function$
DECLARE
	artificial_table_name TEXT := artificial_tables_prefix || '_' || 'heatmap_edges_artificial';
	vertices_table_name TEXT := artificial_tables_prefix || '_' || 'heatmap_starting_vertices';

BEGIN 

	PERFORM basic.create_multiple_artificial_edges(x, y, max_cutoff, speed, modus, scenario_id, routing_profile, grid_ids);
	IF drop_table = TRUE THEN 
		EXECUTE 'DROP TABLE IF EXISTS temporal.'||artificial_table_name; 
		EXECUTE 'CREATE TABLE temporal.'||artificial_table_name||' AS
		SELECT * FROM final_artificial_edges;
		ALTER TABLE temporal.'||artificial_table_name||' ADD PRIMARY KEY(id);
		CREATE INDEX ON temporal.'||artificial_table_name||' USING GIST(geom);'; 
		
		EXECUTE 'DROP TABLE IF EXISTS temporal.'||vertices_table_name||';';
	
		EXECUTE 'CREATE TABLE temporal.'||vertices_table_name||' AS
		SELECT * FROM starting_vertices;
		CREATE INDEX ON temporal.'||vertices_table_name||' USING GIST(geom);';
	
	ELSE 
		EXECUTE 'INSERT INTO temporal.'||artificial_table_name||'
		SELECT * FROM final_artificial_edges;';
		
		EXECUTE 'INSERT INTO temporal.'||vertices_table_name||'
		SELECT * FROM starting_vertices;';
	END IF;
	RETURN query 
	SELECT s.id, s.grid_id FROM starting_vertices s;
END;
$function$;
/*
 *   SELECT basic.heatmap_prepare_artificial(
        ARRAY[11.33151181658887, 11.329836927525742, 11.38984564558536, 11.363184248765355, 11.387008240434048, 11.403206099194247, 11.371122451727029, 11.354846800772224, 11.386274800277878, 11.319657275473947, 11.36398379345171, 11.36452378521658, 11.309681912582171, 11.372770944369712, 11.351968526673739, 11.314154239198311, 11.365373097681584, 11.364028196866364, 11.390881096623627, 11.354995580208708, 11.37967387556875, 11.367948748979948, 11.357973303242176, 11.383677995847302, 11.380168628705773, 11.383500077197363, 11.382751256622504, 11.348444933008688, 11.368102026211377, 11.383087677646568, 11.38010791600567, 11.32631222156514, 11.37808099732201, 11.388602169249861, 11.32378389338054, 11.339457707388398, 11.34014996707774, 11.338073992134811, 11.370432433014454, 11.373159806656542, 11.379613370527727, 11.36671317492067, 11.327397653429099, 11.367055779763074, 11.326861500743393, 11.32605630299858, 11.378732474110379, 11.328687845806298, 11.35092578271132, 11.358718335567124, 11.37312032452882, 11.34735143432613, 11.394213243525217, 11.367551167065502, 11.376935074378537, 11.384791636125582, 11.337627154647397, 11.399871932667164, 11.354697972028028, 11.392428203094237, 11.345071372476605, 11.355740148101743, 11.398932425104016, 11.317868515478992, 11.349535596127007, 11.368297507207453, 11.3901966285047, 11.334305678903867, 11.36234424523353, 11.317524627089968, 11.31315607701018, 11.364278415758655, 11.33976037546456, 11.38998865889582, 11.323234210274522, 11.363237711504988, 11.332314999632976, 11.386657682907964, 11.378177647964499, 11.337424935485847, 11.371771880145692, 11.390976311338793, 11.342882401891508, 11.361795387674686, 11.332365839280056, 11.391821045058254, 11.357923876535166, 11.343334652697273, 11.343279107521484, 11.348991478863363, 11.350676621316603, 11.346161120103988, 11.33200984379607, 11.322288654491855, 11.340502861088172, 11.34045246436408, 11.378865481852499, 11.35420159645185, 11.338318801211715, 11.31112776407307],
        ARRAY[49.11782520618968, 49.07858153329658, 49.09992169511411, 49.08121612454567, 49.08309227558087, 49.107243888107575, 49.07003073647988, 49.089415464548054, 49.10849612312842, 49.09511947549542, 49.122603670116625, 49.07800006514745, 49.0954354732499, 49.113336092377956, 49.07664037241907, 49.08472007394885, 49.115335465930116, 49.0831279891603, 49.08561117002683, 49.07724841896959, 49.116462038942245, 49.08159173483491, 49.08191228245964, 49.07138834246062, 49.111336128831134, 49.12303429016542, 49.11301508213677, 49.0811600637743, 49.104851588326504, 49.084629197093044, 49.079965867768756, 49.083100200350245, 49.10453076160659, 49.09502691531495, 49.077364119779915, 49.106648736754906, 49.12072175993353, 49.078495081405975, 49.09138262923572, 49.080895105940165, 49.08509390184752, 49.11212089254843, 49.100160268223235, 49.08373572875068, 49.07391705717722, 49.10337464215555, 49.122659073363074, 49.101000334742785, 49.09095100674898, 49.09193510294221, 49.12037273225729, 49.099524567403066, 49.097313024169246, 49.07860779861267, 49.09152578068004, 49.12387365075378, 49.07956694780051, 49.0955434987481, 49.10158057897265, 49.10160065262924, 49.07351195500605, 49.087271792059695, 49.10174270297546, 49.09940537749128, 49.09822118519638, 49.08863119431383, 49.10695976593394, 49.06786236391733, 49.11472772280409, 49.092367529946415, 49.09497308068801, 49.098277650648306, 49.08231904263751, 49.087755329429704, 49.086546770518154, 49.112584712224034, 49.08837278508696, 49.076052079666326, 49.09642077292062, 49.09578810299831, 49.08816688924514, 49.077498943474886, 49.11023982884998, 49.08848759665756, 49.084317474777926, 49.07941080803824, 49.08596796068206, 49.07374380794078, 49.11322248833463, 49.07197613192512, 49.111224534580316, 49.09057465711033, 49.112700140629734, 49.092745044321234, 49.0923415239494, 49.096396487296005, 49.07506987402358, 49.07128018784661, 49.09364483770577, 49.084111023567154],
        1200,
        1.3888888888888888,
        'default',
        1,
        'walking_standard',
        FALSE 
    )
 */
  